---
import type { Page, PaginateFunction } from 'astro';
import { getEntry, getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

import Layout from '@/layouts/Layout.astro';
import Posts from '@/components/Posts.astro';
export type Props = {
  page: Page<CollectionEntry<'posts'>>;
};

export async function getStaticPaths({
  paginate,
}: {
  paginate: PaginateFunction;
}) {
  const posts = (await getCollection('posts'))
    .sort(
      (a, b) =>
        (a.data.lastUpdatedDate ?? a.data.publishedDate).getTime() -
        (b.data.lastUpdatedDate ?? b.data.publishedDate).getTime()
    )
    .reverse();

  return paginate(posts, { pageSize: 5 });
}

const meta = await getEntry('site', 'meta');

const { page } = Astro.props;
---

<Layout title={meta.data.index.title} description={meta.data.index.description}>
  <Posts page={page} />
</Layout>
